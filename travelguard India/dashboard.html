<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TravelGuard India - Dashboard</title>
  <style>
    /* ===== Reset & Base Styles ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Arial, sans-serif;
    }

    body {
      background-color: #f3f3f3;
      color: #333;
      line-height: 1.5;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    /* ===== Navbar ===== */
    .navbar {
      background-color: #fff;
      border-bottom: 1px solid #ddd;
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .navbar-logo {
      display: flex;
      align-items: center;
    }

    .navbar-logo-icon {
      background-color: #ffecd9;
      color: #ff6600;
      padding: 10px;
      border-radius: 8px;
      font-weight: bold;
      margin-right: 10px;
    }

    .navbar-logo-text {
      font-size: 1.5rem;
      font-weight: bold;
      color: #333;
    }

    .navbar-logo-text span {
      color: #ff6600;
    }

    .navbar-links {
      display: flex;
      gap: 25px;
      list-style: none;
    }

    .navbar-links li a {
      font-weight: 500;
      transition: color 0.3s;
    }

    .navbar-links li a:hover {
      color: #ff6600;
    }

    .navbar-login button {
      background-color: #ff6600;
      color: white;
      padding: 8px 18px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.3s;
    }

    .navbar-login button:hover {
      background-color: #e65c00;
    }

    /* ===== Main Grid Layout ===== */
    .dashboard-container {
      max-width: 1200px;
      margin: 30px auto;
      padding: 0 20px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    /* ===== Digital ID ===== */
    .digital-id-content {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .digital-id-qr img {
      width: 120px;
      height: 120px;
      background: #f5f5f5;
      border-radius: 10px;
      padding: 10px;
    }

    .digital-id-info p {
      margin-bottom: 8px;
    }

    .verify-btn {
      margin-top: 10px;
      background-color: #28a745;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .verify-btn:hover {
      background-color: #218838;
    }

    /* ===== SOS Section ===== */
    .sos-btn {
      background-color: #e60000;
      color: white;
      border: none;
      padding: 20px 40px;
      border-radius: 50%;
      font-size: 1.5rem;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }

    .sos-btn:hover {
      background-color: #cc0000;
    }

    .sos-status {
      margin-top: 10px;
      font-weight: bold;
      color: #555;
    }

    /* ===== Geofencing Section ===== */
    .geofence-map {
      width: 100%;
      height: 400px;
      border-radius: 12px;
      border: 1px solid #ccc;
    }

    .geofence-status {
      margin-top: 10px;
      font-weight: bold;
    }

    /* ===== Chat Widget ===== */
    #chat-widget-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #ff6600;
      color: white;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    #chat-widget {
      position: fixed;
      bottom: 90px;
      right: 20px;
      width: 300px;
      max-height: 400px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 10px;
      display: none;
      flex-direction: column;
      overflow: hidden;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    .chat-header {
      background: #ff6600;
      color: white;
      padding: 10px;
      text-align: center;
      font-weight: bold;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
    }

    .chat-input-area {
      display: flex;
      border-top: 1px solid #ddd;
    }

    .chat-input-area input {
      flex: 1;
      padding: 8px;
      border: none;
      outline: none;
    }

    .chat-input-area button {
      background: #ff6600;
      color: white;
      border: none;
      padding: 8px 12px;
      cursor: pointer;
    }

    /* ===== Footer ===== */
    footer {
      background: #fff4e6;
      padding: 15px;
      text-align: center;
      font-size: 0.9rem;
      color: #555;
      margin-top: 30px;
    }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar">
    <div class="navbar-logo">
      <div class="navbar-logo-icon">TG</div>
      <div class="navbar-logo-text">TravelGuard<span>+</span></div>
    </div>
    <ul class="navbar-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="dashboard.html">Dashboard</a></li>
      <li><a href="report.html">Report Incident</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
    <div class="navbar-login">
      <a href="login.html"><button>Login</button></a>
    </div>
  </nav>

  <!-- Main Dashboard -->
  <div class="dashboard-container">
    
    <!-- Digital ID -->
    <div class="card digital-id-section">
      <h2>Digital ID</h2>
      <div class="digital-id-content">
        <div class="digital-id-qr">
          <img src="assets/qr-code.png" alt="QR Code">
        </div>
        <div class="digital-id-info">
          <p><strong>Tourist Name:</strong> <span id="user-name"></span></p>
          <p><strong>Passport:</strong> <span id="user-passport"></span></p>
          <p><strong>Emergency Contact:</strong> <span id="user-contact"></span></p>
          <button class="verify-btn">Verify ID</button>
        </div>
      </div>
    </div>

    <!-- SOS Section -->
    <div class="card sos-section">
      <h2 style="color:#e60000;">Emergency SOS</h2>
      <div style="text-align:center; margin-top:15px;">
        <button class="sos-btn" id="sos-btn">SOS</button>
        <p class="sos-status" id="sos-status"></p>
      </div>
    </div>

    <!-- Geofencing Section -->
    <div class="card geofence-section" style="grid-column: span 2;">
      <h2>Geofencing Safety Zone</h2>
      <div id="geofence-map" class="geofence-map"></div>
      <p id="geofence-status" class="geofence-status"></p>
    </div>
  </div>

  <!-- Chatbot -->
  <button id="chat-widget-toggle">💬</button>
  <div id="chat-widget">
    <div class="chat-header">Safety AI Bot</div>
    <div class="chat-messages" id="chat-messages"></div>
    <div class="chat-input-area">
      <input id="chat-input" type="text" placeholder="Ask for help...">
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    Smart Tourist Safety Monitoring & Incident Response System | Developed by Technies United, Arjun College Of Technology
  </footer>

  <!-- Google Maps API -->
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=geometry,drawing"></script>

  <script>
    // ===== Load User Data =====
    document.addEventListener("DOMContentLoaded", () => {
      const userData = JSON.parse(localStorage.getItem("touristUser"));
      if (userData) {
        document.getElementById("user-name").textContent = userData.name;
        document.getElementById("user-passport").textContent = userData.passport;
        document.getElementById("user-contact").textContent = userData.emergencyContact;
      } else {
        alert("No user data found. Please login first.");
        window.location.href = "login.html";
      }
    });

    // ===== SOS Button =====
    document.getElementById('sos-btn').addEventListener('click', () => {
      const sosStatus = document.getElementById('sos-status');
      if (navigator.geolocation) {
        sosStatus.textContent = "Fetching location...";
        navigator.geolocation.getCurrentPosition(position => {
          const lat = position.coords.latitude;
          const lng = position.coords.longitude;
          sosStatus.textContent = "Alert sent to police!";
          alert(`🚨 Emergency alert sent!\nLocation: https://maps.google.com/?q=${lat},${lng}`);
        }, () => {
          sosStatus.textContent = "Unable to retrieve location.";
        });
      } else {
        sosStatus.textContent = "GPS not supported on this device.";
      }
    });

    // ===== Google Maps Geofencing =====
    let map;
    let geofence;
    let userMarker;

    function initMap() {
      map = new google.maps.Map(document.getElementById("geofence-map"), {
        center: { lat: 20.5937, lng: 78.9629 },
        zoom: 5
      });

      const drawingManager = new google.maps.drawing.DrawingManager({
        drawingControl: true,
        drawingModes: ['circle', 'polygon']
      });
      drawingManager.setMap(map);

      google.maps.event.addListener(drawingManager, 'overlaycomplete', function(event) {
        if (geofence) geofence.setMap(null);
        geofence = event.overlay;
        alert("Geofence area set!");
      });

      if (navigator.geolocation) {
        navigator.geolocation.watchPosition(position => {
          const pos = { lat: position.coords.latitude, lng: position.coords.longitude };

          if (!userMarker) {
            userMarker = new google.maps.Marker({ position: pos, map: map, title: "Your Location" });
            map.setCenter(pos);
            map.setZoom(14);
          } else {
            userMarker.setPosition(pos);
          }

          checkGeofence(pos);
        });
      }
    }

    function checkGeofence(userLocation) {
      const status = document.getElementById("geofence-status");

      if (!geofence) {
        status.textContent = "No geofence set.";
        return;
      }

      let inside = false;

      if (geofence.type === 'circle') {
        const distance = google.maps.geometry.spherical.computeDistanceBetween(
          new google.maps.LatLng(userLocation),
          geofence.getCenter()
        );
        inside = distance <= geofence.getRadius();
      } else if (geofence.type === 'polygon') {
        inside = google.maps.geometry.poly.containsLocation(
          new google.maps.LatLng(userLocation),
          geofence
        );
      }

      status.textContent = inside
        ? "You are inside the safe zone ✅"
        : "⚠️ You are outside the safe zone!";
    }

    window.onload = initMap;

    // ===== Chatbot =====
    const chatToggle = document.getElementById('chat-widget-toggle');
    const chatWidget = document.getElementById('chat-widget');
    const chatMessages = document.getElementById('chat-messages');

    chatToggle.addEventListener('click', () => {
      chatWidget.style.display = chatWidget.style.display === 'flex' ? 'none' : 'flex';
      chatWidget.style.flexDirection = 'column';
    });

    function sendMessage() {
      const input = document.getElementById('chat-input');
      const message = input.value.trim();
      if (!message) return;

      addChatMessage('user', message);
      input.value = '';

      setTimeout(() => {
        const reply = getBotResponse(message.toLowerCase());
        addChatMessage('bot', reply);
      }, 500);
    }

    function addChatMessage(sender, text) {
      const div = document.createElement('div');
      div.style.marginBottom = '10px';
      div.style.textAlign = sender === 'user' ? 'right' : 'left';
      div.innerHTML = `<span style="background:${sender === 'user' ? '#007bff' : '#eee'}; 
                       color:${sender === 'user' ? '#fff' : '#000'}; padding:8px 12px; 
                       border-radius:10px;">${text}</span>`;
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function getBotResponse(input) {
      if (input.includes("hospital")) return "Nearest hospital is 2 km away at Green Care Hospital.";
      if (input.includes("police")) return "Dial 100 to reach local police.";
      if (input.includes("passport")) return "Visit your embassy immediately to report a lost passport.";
      if (input.includes("help")) return "I'm here to help! Tell me what's wrong.";
      return "I'm not sure, please stay safe and call emergency services if needed.";
    }
  </script>
</body>
</html>
